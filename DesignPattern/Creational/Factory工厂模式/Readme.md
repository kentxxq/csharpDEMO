| 类型              | 别名   | 可以做到的效果                 |
|-----------------|------|-------------------------|
| SimpleFactory   | 简单工厂 | 创建简单类似的对象               |
| ReflectFactory  | 反射工厂 | 适用性很广，但是对性能不好           |
| FactoryMethod   | 工厂方法 | 用不同的方式来创建功能类似的产品        |
| AbstractFactory | 抽象工厂 | 类似工厂方法，但是把不同工厂的通用方法抽象出来 |

### 说明

简单工厂和反射工厂没啥好说的。

### 工厂方法

工厂方法不仅仅是创建不同的产品，还可以改变创建的方式！例子就是`RandomFactory`。 其中OCP就是开放封闭原则。对拓展开放，对修改封闭。

1. 随着产品的增多、创建方式的增多，工厂也越来越多。同一个等级下面，支持增加任意产品。
2. 每一个工厂内部是相对封闭的

这里通过多个不同类型、且相对封闭的工厂

1. 避免了一个简单工厂过于复杂的问题，因为一个类里面包含过多的外部逻辑，会导致自己本身不够稳定
2. 方便拓展，通过拓展工厂类就可以有多种不同的生产方式

### 抽象工厂

工厂方法很容易会产生非常多的工厂，抽象工厂的目的就是对共有的内容进行统一。形成了产品簇的概念。

1. 小米工厂和苹果工厂都有高中低3条产品线
2. 如果用工厂方法，我们会需要6个工厂类。而抽象方法可以让我们抽象出来3个等级。使用特定的工厂时，直接生产对应的3个等级产品

这里对比工厂方法，有一下好处

1. 工厂类通常生产单一的产品，而多个手机工厂，都有相似的高中低3条产品线。抽象出来共有的特点，可以从不同维度对工厂进行分类

### 总结

#### 工厂是做什么的？

希望能够创建一个对象，但创建过程比较复杂，或者想对外隐藏这些细节。因为特别复杂，所以没办法直接一个`new`优雅的写出来。

#### 复杂的创建过程

1. 数据库连接池就是这样的。我们在刚启动的时候，需要10个连接。每次要用，都从一个pool里面取。这时候用factory，屏蔽掉里面细节
2. 隐藏真实的实现类。一个工厂创建的对象可能用a、可能用b来实现phone接口。使用factory可以让调用者无感。
3. 创建一个对象需要由许多的小组件构成。而一个类不应该包含太多的外部逻辑。这时候就需要不同的工厂类来组装这些小组件，已满足不同的需求

### 源码举例

在aspnetcore的官方文档中有推荐使用`httpClientFactory`
，拿来举例应该最好不过。[源码地址](https://github.com/dotnet/runtime/blob/4ed3063d8bc434fd29fe63cf093c17baa9ff8fd3/src/libraries/Microsoft.Extensions.Http/src/DefaultHttpClientFactory.cs)

#### 问题分析

1. 用户不可避免的需要调用外部的http接口。需要一个httpClient
2. 如果让用户在每个地方自己去new对象，可能代码很复杂。需要`配置Header`，需要配置`请求域名和根路径`,需要`配置超时`
3. 对所有第三方接口调用的时候，想要`记录日志`，或者`拦截所有的超时并处理`。也就是说还想拓展httpClient

#### 选型时候的考虑

1. 从后二点来说，我们肯定是需要一个工厂的。这样可以避免在每个地方都产生非常多的冗余代码。
2. 首先我们考虑简单工厂。我们通过用户的传参，然后创建一个httpClient给用户。如果用户自己也不确定header等信息，要读取配置呢？那就需要多一个方法，从配置中解析。这种需求会不断增多，导致简单工厂不再简单。
3. 所以当构建一个httpClient的方式越来越多，如何构建就会变得越来越重要。我们就创建多个工厂，互相隔离内部逻辑。
4. 那么使用工厂方法，已经把不同的对象生成逻辑隔离开来。有必要使用抽象工厂吗？
5. 我们生产出来的产品是固定的，即httpClient。暂时并不需要用到产品簇相关的概念。
6. 我们的选型应该尽量简单。简单工厂=》工厂方法=》抽象工厂

### 概括一下

1. 我们创建一个手机，手机的功能是差不多的。
2. 但是我们可以创造不同质量的手机，高级手机可能防摔比低级的做得好。
3. 而不同的手机厂商都可以升级不同等级的手机。
4. 注意我们的手机功能其实是差不多的。
5. 那么如果生产流程固定，需要生产不一样功能的手机呢？就使用builder构建者模式
6. 工厂模式适合创建手机，因为是功能类似的产品
7. 构建者适合解析一步一步来。比如解析一个markdown。我们可以根据不同的前缀来解析下面的内容。然后一个一个拼接来